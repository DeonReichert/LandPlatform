#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "üîí Running pre-commit security checks..."

# Run lint-staged for automatic fixes
npx lint-staged

# Security check: prevent committing sensitive files
if git diff --cached --name-only | grep -E "(\.env$|\.key$|private.*key|secret.*key)"; then
  echo "‚ùå Error: Attempting to commit sensitive files (.env, .key, private keys)"
  echo "   Please remove them from staging area"
  exit 1
fi

# Security check: detect hardcoded secrets in staged files
if git diff --cached | grep -iE "(private.*key.*=|secret.*=|password.*=|api.*key.*=|PRIVATE_KEY|SECRET_KEY)" | grep -v "VITE_"; then
  echo "‚ö†Ô∏è  Warning: Possible hardcoded secrets detected in staged files"
  echo "   Please review your changes before committing"
  read -p "Continue anyway? (y/N): " -n 1 -r
  echo
  if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    exit 1
  fi
fi

echo "‚úÖ Pre-commit checks passed!"
