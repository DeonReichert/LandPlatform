#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push security and quality checks..."

# Run tests before push
echo "ğŸ“‹ Running tests..."
npm run test || {
  echo "âŒ Tests failed. Push aborted."
  exit 1
}

# TypeScript type check
echo "ğŸ” Checking TypeScript types..."
npx tsc --noEmit || {
  echo "âŒ TypeScript errors detected. Push aborted."
  exit 1
}

# Security audit
echo "ğŸ”’ Running security audit..."
npm audit --audit-level=high || {
  echo "âš ï¸  Security vulnerabilities detected (high/critical)"
  read -p "Continue anyway? (y/N): " -n 1 -r
  echo
  if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    exit 1
  fi
}

echo "âœ… Pre-push checks passed! Pushing to remote..."
